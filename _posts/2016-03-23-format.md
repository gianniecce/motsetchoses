---
layout: post
title:  "Data Format"
categories: [jekyll]
tags: [mtus]
---


<span class='newthought'>This post</span> will discuss the 3 most common data format in Time Use: 

1. Short Person-Persion ("Spells") format 
2. Long Person-Persion ("Spells") format 
3. State sequences (Wide) format 


#### Load the libraries and data 


{% highlight r %}
library(plyr)
library(dplyr)
library(tidyr)
library(mtusRlocal)
library(knitr)
library(reshape2)
library(xtable)

library('schoolmath')

dta = read.csv('/Users/giacomovagni/site/motsetchoses/_data/dtaSpells.csv')
{% endhighlight %}


| id |   day    | activities | duration | epnum |
|:--:|:--------:|:----------:|:--------:|:-----:|
| 1  | Saturday |   sleep    |   500    |   1   |
| 1  | Saturday | free time  |   400    |   2   |
| 1  | Saturday |   eating   |   100    |   3   |
| 1  | Saturday |  domestic  |   300    |   4   |
| 1  | Saturday |     TV     |   140    |   5   |
| 1  |  Monday  |   sleep    |   300    |   1   |
| 1  |  Monday  | paid work  |   500    |   2   |
| 1  |  Monday  |   eating   |   200    |   3   |
| 1  |  Monday  |     TV     |   400    |   4   |
| 1  |  Monday  |   eating   |    40    |   5   |


{% highlight r %}
dtaPP = dta[rep(1:nrow(dta), dta$duration), ] %>% 
  select(-duration) %>% 
  group_by(id, day) %>% 
  mutate( Time = 1:n())
{% endhighlight %}

Let's look at the first 10 entries 


| id |   day    | activities | epnum | Time |
|:--:|:--------:|:----------:|:-----:|:----:|
| 1  | Saturday |   sleep    |   1   |  1   |
| 1  | Saturday |   sleep    |   1   |  2   |
| 1  | Saturday |   sleep    |   1   |  3   |
| 1  | Saturday |   sleep    |   1   |  4   |
| 1  | Saturday |   sleep    |   1   |  5   |
| 1  | Saturday |   sleep    |   1   |  6   |
| 1  | Saturday |   sleep    |   1   |  7   |
| 1  | Saturday |   sleep    |   1   |  8   |
| 1  | Saturday |   sleep    |   1   |  9   |
| 1  | Saturday |   sleep    |   1   |  10  |

The maximum time per day is 

{% highlight r %}
dtaPP %>% group_by(id, day) %>% summarise(max(Time))
{% endhighlight %}



{% highlight text %}
## Source: local data frame [2 x 3]
## Groups: id
## 
##   id      day max(Time)
## 1  1   Monday      1440
## 2  1 Saturday      1440
{% endhighlight %}

which means that we have created a one minute interval dataset, known as **Long Person-Period**: 

This code enables to transform the long file into a **Wide Sequence** file. 

{% highlight r %}
dtaWide = dtaPP %>% select(-epnum) %>% spread(Time, activities)
{% endhighlight %}

The 10 first sequence episodes look like this : 


| id |   day    |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |  10   |
|:--:|:--------:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
| 1  |  Monday  | sleep | sleep | sleep | sleep | sleep | sleep | sleep | sleep | sleep | sleep |
| 1  | Saturday | sleep | sleep | sleep | sleep | sleep | sleep | sleep | sleep | sleep | sleep |


## Change the interval time 

Find the greatest common divisor 


{% highlight r %}
l = length(dta$duration) 
v = array(0, l)

for(i in 2:l){
  v[i] = gcd(dta$duration[i], dta$duration[i-1]) 
}

minV = min(v[-1]) 
minV
{% endhighlight %}



{% highlight text %}
## [1] 20
{% endhighlight %}



{% highlight r %}
dta$duration = dta$duration / minV
{% endhighlight %}


{% highlight r %}
dtaPP = dta[rep(1:nrow(dta), dta$duration), ] %>% 
  select(-duration) %>% 
  group_by(id, day) %>% 
  mutate( Time = 1:n())
{% endhighlight %}

The new Long Person Period file has now `72` episodes, which is equals to `1440` when multiplied by `20` 


{% highlight r %}
dtaPP %>% group_by(id, day) %>% summarise(max(Time))
{% endhighlight %}



{% highlight text %}
## Source: local data frame [2 x 3]
## Groups: id
## 
##   id      day max(Time)
## 1  1   Monday        72
## 2  1 Saturday        72
{% endhighlight %}



{% highlight r %}
72 * 20
{% endhighlight %}



{% highlight text %}
## [1] 1440
{% endhighlight %}



