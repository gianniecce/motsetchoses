---
layout: post
title:  "Compute mean for activities - all format"
categories: [jekyll]
tags: [mtus]
---


<span class='newthought'>This post</span> will demonstrate how to simply calcualte mean time of different activities from a *PP-short* dataset. 

```{r, warning=FALSE, message=FALSE}

# Load the libraries and data
library(plyr)
library(dplyr)
library(tidyr)
library(mtusRlocal)
library(knitr)
library(reshape2)
library(xtable)

dta = read.csv('/Users/giacomovagni/site/motsetchoses/_data/dtaSpells.csv')
```

### Mean of Short PP file 

The `sum` of all activites duration for each individuals for a day must be **1440**. 

```{r}
dta %>% group_by(id, day) %>% summarise(sum(duration))
```

The individual mean can be computed such as : 
```{r}
dta %>% group_by(id, activities) %>% summarise(mean(duration))
```

The aggregate mean by day : 
```{r}
dta %>% group_by(day, activities) %>% summarise(mean(duration))
```

The aggregate mean by activities, regardless of the day : 
```{r}
dta %>% group_by(activities) %>% summarise(mean(duration))
```

### Mean of Long PP file 

```{r}
# transform 
dtaPP= dta[rep(1:nrow(dta), dta$duration), ] %>% 
  select(-duration) %>% 
  group_by(id, day) %>% 
  mutate(Time = 1:n()) 

dtaPP %>% group_by(id, day, activities) %>% summarise(time = n()) %>% # transform back to short PP 
  group_by(activities, day) %>% 
  summarise(mean(time))
```

### Mean of Sequence File 


#### Aggregate  

The mean time of activities for long PP can be computed by the following codes : 

```{r}
# transform PP to Wide 
dtaSeq = dta[rep(1:nrow(dta), dta$duration), ] %>% 
  select(-duration) %>% 
  group_by(id, day) %>% 
  mutate(Time = 1:n()) %>% # PP 
  arrange(id, day, Time) %>% select(-epnum) %>% spread(Time, activities) # Wide 

# colnames renames  
colnames(dtaSeq) = c('idind', 'day', paste("main", 1:1440, sep = ""))
```

```{r}
N = count(dtaSeq) 
N 
# by act only
dtaSeq %>% select(idind, day, matches('main')) %>% 
  melt(id.vars = c("idind", "day")) %>% group_by(value) %>% summarise(n = n()) %>% # back to PP 
  mutate(time =  (n* 1) / 4 ) %>% # divide by count 
  mutate(TimeClock(time)) 

# by act and days 
dtaSeq %>% select(idind, day, matches('main')) %>% 
  melt(id.vars = c("idind", "day")) %>% group_by(day, value) %>% summarise(n = n()) %>% 
  mutate(time =  (n* 1) / 2) %>% # divide by count 
  mutate(TimeClock(time)) 

# if you haev the full data then group by what you want  
dtaSeq %>% select(idind, day, matches('main')) %>% 
  melt(id.vars = c("idind", "day")) %>% group_by(idind, day, value) %>% summarise(n = n()) %>% 
  group_by(value) %>% summarise( mean(n) ) 
  mutate(TimeClock(time)) 
  
# or simply activities 
  dtaSeq %>% select(idind, day, matches('main')) %>% 
  melt(id.vars = c("idind", "day")) %>% group_by(idind, day, value) %>% summarise(n = n()) %>% 
  group_by(value, day) %>% summarise( mean(n) ) 
  mutate(TimeClock(time)) 
``` 

#### Individual

From a PP file  

```{r}
head(dtaPP)
```


```{r}
dtaPP_sum = dtaPP %>% 
  group_by(id, day, activities) %>% 
  summarise(n = n() * 1) %>% # multiply by the interval - here is 1 minutes 
  mutate(activities = paste('act_', activities, sep = '')) %>% 
  spread(activities, n, fill = 0) 

dtaPP_sum

dtaPP_sum %>% select(-id, -day) %>% summarise_each(funs(mean))
```





