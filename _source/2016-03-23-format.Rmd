---
layout: post
title:  "Data Format"
categories: [jekyll]
tags: [mtus]
---


<span class='newthought'>This post</span> will discuss how to transform the 3 most common data format in Time Use using `R`. 

The data formats will be referred to as : 

a) Person Period Short format \\
b) Person Period Long format \\
c) State sequences (*Wide*) format



```{r, warning=FALSE, message=FALSE}
# Load the libraries and data

library(plyr)
library(dplyr)
library(tidyr)
library(mtusRlocal)
library(knitr)
library(reshape2)
library(xtable)

dta = read.csv('/Users/giacomovagni/site/motsetchoses/_data/dtaSpells.csv')
```

### Person Period Short format 

Time use data generally come into a shortened *Person-Period* format. 
Take a look at this sample : 

```{r, results='asis', echo=FALSE}
kable(dta, align = 'c') 
```

```{r} 
dtaPP = dta[rep(1:nrow(dta), dta$duration), ] %>% 
  select(-duration) %>% 
  group_by(id, day) %>% 
  mutate( Time = 1:n())
```

### Person Period Long format 

Let's look at the first 10 entries 

```{r, results='asis', echo=FALSE}
kable(dtaPP [1:10, ], align = 'c') 
```

The maximum time per day is 
```{r}
dtaPP %>% group_by(id, day) %>% summarise(max(Time))
```

which means that we have created a one minute interval dataset, known as **Long Person-Period**: 

### Sequence (Wide) format

This code enables to transform the long file into a **Wide Sequence** file. 
```{r}
dtaWide = dtaPP %>% select(-epnum) %>% spread(Time, activities)
```

The 10 first sequence episodes look like this : 

```{r, results='asis', echo=FALSE}
kable( dtaWide [, 1:12] , align = 'c') 
```

### Return to short PP format

A simple and convenient way to return to the original short PP way 


```{r}
dtaMeltPP = dtaWide %>% melt(id.vars = c("id", "day")) %>% arrange(id, day, variable)
dtaMeltPP %>% head()
```

```{r}
  dtaMeltPP %>% 
  group_by(id, day, value) %>% 
  mutate(time = n() * 1) %>% 
  select(-variable) %>% distinct() %>% # keeps the order 
  group_by(id, day) %>% 
  mutate(epnum = 1:n())
```





