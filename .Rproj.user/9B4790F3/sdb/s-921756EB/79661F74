{
    "contents" : "---\nlayout: post\ntitle:  \"Data Format\"\ncategories: [jekyll]\ntags: [mtus]\n---\n\n\n<span class='newthought'>This post</span> will discuss how to transform the 3 most common data format in Time Use using `R`. \n\nThe data formats will be referred to as : \n\na) Person Period Short format \\\\\nb) Person Period Long format \\\\\nc) State sequences (*Wide*) format\n\n\n\n```{r, warning=FALSE, message=FALSE}\n# Load the libraries and data\n\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(mtusRlocal)\nlibrary(knitr)\nlibrary(reshape2)\nlibrary(xtable)\n\ndta = read.csv('/Users/giacomovagni/site/motsetchoses/_data/dtaSpells.csv')\n```\n\n### Person Period Short format \n\nTime use data generally come into a shortened *Person-Period* format. \nTake a look at this sample : \n\n```{r, results='asis', echo=FALSE}\nkable(dta, align = 'c') \n```\n\n```{r} \ndtaPP = dta[rep(1:nrow(dta), dta$duration), ] %>% \n  select(-duration) %>% \n  group_by(id, day) %>% \n  mutate( Time = 1:n())\n```\n\n### Person Period Long format \n\nLet's look at the first 10 entries \n\n```{r, results='asis', echo=FALSE}\nkable(dtaPP [1:10, ], align = 'c') \n```\n\nThe maximum time per day is \n```{r}\ndtaPP %>% group_by(id, day) %>% summarise(max(Time))\n```\n\nwhich means that we have created a one minute interval dataset, known as **Long Person-Period**: \n\n### Sequence (Wide) format\n\nThis code enables to transform the long file into a **Wide Sequence** file. \n```{r}\ndtaWide = dtaPP %>% select(-epnum) %>% spread(Time, activities)\n```\n\nThe 10 first sequence episodes look like this : \n\n```{r, results='asis', echo=FALSE}\nkable( dtaWide [, 1:12] , align = 'c') \n```\n\n### Return to short PP format\n\nA simple and convenient way to return to the original short PP way \n\n\n```{r}\ndtaMeltPP = dtaWide %>% melt(id.vars = c(\"id\", \"day\")) %>% arrange(id, day, variable)\ndtaMeltPP %>% head()\n```\n\n```{r}\n  dtaMeltPP %>% \n  group_by(id, day, value) %>% \n  mutate(time = n() * 1) %>% \n  select(-variable) %>% distinct() %>% # keeps the order \n  group_by(id, day) %>% \n  mutate(epnum = 1:n())\n```\n\n\n\n\n\n",
    "created" : 1458743192134.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1832558863",
    "id" : "79661F74",
    "lastKnownWriteTime" : 1459013064,
    "path" : "~/site/motsetchoses/_source/2016-03-23-format.Rmd",
    "project_path" : "_source/2016-03-23-format.Rmd",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_markdown"
}