{
    "contents" : "\n##############################\n# In this script, I will compute the mean time for 2015 \n##############################\n\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(reshape2)\nlibrary(tidyr)\nlibrary(foreign)\nlibrary(TraMineR)\nlibrary(mtusRlocal)\nlibrary(ggplot2)\nlibrary(Hmisc)\nlibrary(lubridate)\nlibrary(RColorBrewer)\n\nTimeProp = function(x) { round( ( x / 1440), 2)  }\n\n########################################################################################################################\n########################################################################################################################\n\nload(file = '/Users/giacomovagni/Rprojects/togetherness/data/uk2015/ukAll2015whom.RData')\n\n########################################################################################################################\n########################################################################################################################\n\n# \n# I need to select my population here \n# \n\nukAll2015whomII = filter(ukAll2015whom, civstat == 'In couple (married/cohabit/civil partnership)') %>% \n  filter(age > 17 & age < 66)\n# \nn_distinct(ukAll2015whomII$idind)\n# check \nrange(ukAll2015whomII$age) \n\n# sex \ntable(ukAll2015whomII$sex) %>% cp(NULL)\n\n# cohabitation \nukAll2015whomII %>% group_by(sex, cohab) %>% summarise(n = n()) %>% mutate(n = n / sum(n)) %>% spread(sex, n)\n\n######\nukAll2015whomIImen = filter(ukAll2015whomII, sex == 'Man')\nukAll2015whomIIwomen = filter(ukAll2015whomII, sex == 'Woman')\n######\n\n\n########### ########### ########### ########### ########### ########### ########### ########### \n########### Individual mean time ########### ########### ########### ########### ########### ## \n########### ########### ########### ########### ########### ########### ########### ########### \n\n# d = ukAll2015whomIImen %>% select(idind, day, matches('alone')) %>% melt(id.vars = c('idind', 'day'))\n# table(d$value) * 5 / count(ukAll2015whomIImen)\n\n# 1. Alone \naloneSumInd = ukAll2015whomIImen %>% select(idind, day, matches('alone')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(time = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, time, fill = 0)  \n\naloneSumInd$timeAlone = aloneSumInd$`1` \naloneSumInd = aloneSumInd %>% select(idind, day, timeAlone)\n\n# 2. Spouse Total  \nSpouseTotSumInd = ukAll2015whomIImen %>% select(idind, day, matches('spousaltimeTotal')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(time = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, time, fill = 0)  \n\nSpouseTotSumInd$timeSpouseTotal = SpouseTotSumInd$`1` \nSpouseTotSumInd = SpouseSumInd %>% select(idind, day, timeSpouseTotal)\n\n# 3. Spouse Exclusive  \nSpouseExSumInd = ukAll2015whomIImen %>% select(idind, day, matches('spousaltimeExclusive')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(time = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, time, fill = 0)  \n\nSpouseExSumInd$timeSpouseExclusive = SpouseExSumInd$`1` \nSpouseExSumInd = SpouseExSumInd %>% select(idind, day, timeSpouseExclusive)\n\n# 4. Nuclear Time   \nNucSumInd = ukAll2015whomIImen %>% select(idind, day, matches('nuclearTime')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(time = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, time, fill = 0)  \n\nNucSumInd$timeNuclear = NucSumInd$`1` \nNucSumInd = NucSumInd %>% select(idind, day, timeNuclear)\n\n# 5. Children Ex  \nChildSumInd = ukAll2015whomIImen %>% select(idind, day, matches('childrentime')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(time = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, time, fill = 0)  \n\nChildSumInd$timeChildrenEx = ChildSumInd$`1` \nChildSumInd = ChildSumInd %>% select(idind, day, timeChildrenEx)\n\n# 6. Others   \nOthersSumInd = ukAll2015whomIImen %>% select(idind, day, matches('others')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(time = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, time, fill = 0)  \n\nOthersSumInd$timeOthers = OthersSumInd$Mentioned \nOthersSumInd = OthersSumInd %>% select(idind, day, timeOthers)\n\n# \ncount(ukAll2015whomIImen)\ncount(aloneSumInd)\n\nukAll2015whomIImen_good = join_all(list(ukAll2015whomIImen, aloneSumInd, SpouseTotSumInd, SpouseExSumInd, NucSumInd, ChildSumInd, OthersSumInd), by = c('idind', 'day')) \ncount(ukAll2015whomIImen_good) \n\nukAll2015whomIImen_good$timeAlone %>% mean()\nukAll2015whomIImen_good$timeSpouseTotal %>% mean()\nukAll2015whomIImen_good$timeSpouseExclusive %>% mean()\nukAll2015whomIImen_good$timeNuclear %>% mean()\nukAll2015whomIImen_good$timeChildrenEx %>% mean()\nukAll2015whomIImen_good$timeOthers %>% mean()\n\n##############################\n############################## Mean Time \n##############################\n\nukAll2015whomIImen_good %>% group_by(empstat) %>% summarise(mean(timeAlone))\nukAll2015whomIImen_good %>% group_by(empstat) %>% summarise(mean(timeSpouseTotal))\nukAll2015whomIImen_good %>% group_by(empstat) %>% summarise(mean(timeSpouseExclusive))\nukAll2015whomIImen_good %>% group_by(empstat) %>% summarise(mean(timeNuclear))\nukAll2015whomIImen_good %>% group_by(cohab) %>% summarise(mean(timeSpouseTotal))\n\n# impressionant l'effet de l'education \nukAll2015whomIImen_good %>% group_by(edcat, empstat) %>% summarise(mean(timeSpouseTotal))\n\n# chaud ! \ntable(ukAll2015whomIImen_good$empstat, ukAll2015whomIImen_good$edcat) %>% cp(2)\n# \n\ntable(ukAll2015whomIImen_good$empstat, ukAll2015whomIImen_good$edcat)\n# 4 times the odds of being full time working \n(1190 / 194) / (107 / 84) \n\nmargin.table( table(ukAll2015whomIImen_good$empstat, ukAll2015whomIImen_good$edcat), 1) \nmargin.table( table(ukAll2015whomIImen_good$empstat, ukAll2015whomIImen_good$edcat), 2) \n\ntable(ukAll2015whomIImen_good$edcat) %>% cp(NULL)\n# 78 % des High Edu -> FT \n1190 / 1511\n# 50 % des Low Edu -> FT \n107 / 215 \n\n\n\n#####\n# working hours \n#####\nukAll2015whomIImen_good$workhrsREC = ukAll2015whomIImen_good$workhrs \nukAll2015whomIImen_good$workhrsREC[is.na(ukAll2015whomIImen_good$workhrs)] <- 0\n# \nukAll2015whomIImen_good %>% group_by(day, emp) %>% summarise(m = mean(timeAlone)) %>% mutate(TimeClock(m))\n\nlm(ukAll2015whomIImen_good$timeAlone ~ ukAll2015whomIImen_good$season + ukAll2015whomIImen_good$empstat + ukAll2015whomIImen_good$cohab + ukAll2015whomIImen_good$day + ukAll2015whomIImen_good$age + I(ukAll2015whomIImen_good$age^2) ) %>% summary()\n\nlm(ukAll2015whomIImen_good$timeChildrenEx ~ ukAll2015whomIImen_good$empstat + ukAll2015whomIImen_good$season + ukAll2015whomIImen_good$cohab + ukAll2015whomIImen_good$day + ukAll2015whomIImen_good$age + I(ukAll2015whomIImen_good$age^2) ) %>% summary()\nlm(ukAll2015whomIImen_good$timeChildrenEx ~ ukAll2015whomIImen_good$workhrsREC + ukAll2015whomIImen_good$season + ukAll2015whomIImen_good$cohab + ukAll2015whomIImen_good$day + ukAll2015whomIImen_good$age + I(ukAll2015whomIImen_good$age^2) ) %>% summary()\n\nlm(ukAll2015whomIImen_good$timeNuclear ~ ukAll2015whomIImen_good$empstat + ukAll2015whomIImen_good$season + ukAll2015whomIImen_good$cohab + ukAll2015whomIImen_good$day + ukAll2015whomIImen_good$age + I(ukAll2015whomIImen_good$age^2) ) %>% summary()\nlm(ukAll2015whomIImen_good$timeSpouseTotal ~ ukAll2015whomIImen_good$empstat + ukAll2015whomIImen_good$season + ukAll2015whomIImen_good$cohab + ukAll2015whomIImen_good$day + ukAll2015whomIImen_good$age + I(ukAll2015whomIImen_good$age^2) ) %>% summary()\n\n# \ntable(ukAll2015whomIImen_good$emp, ukAll2015whomIImen_good$civstat) %>% cp(1)\n\n# correct \nukAll2015whomIImenIII$Mentioned %>% mean(na.rm = T) %>% TimeClock() \nukAll2015whomIImenIII$Mentioned %>% mean(na.rm = T) %>% TimeProp \n\n##############################\n# WOMEN #  \n##############################\n\nn_distinct(ukAll2015whomIIwomen$idind)\n\n# not working \na = ukAll2015whomIIwomen %>% select(matches('alone'))\n( table(unlist(a)) * 5 ) / count(ukAll2015whomIIwomen)\n\n########### Aggregate mean time \n\n# NBR OF MEN \ncount(ukAll2015whomIImenI)\n# calculate mean time ALONE \nukAll2015whomIIwomen %>% select(matches('alone')) %>% gather %>% group_by(value) %>% summarise(n = n()) %>% mutate(timealone =  (n* 5) / 5653)\n# percentage per interval \nukAll2015whomIIwomen %>% select(matches('alone')) %>% gather %>% group_by(key, value) %>% summarise(n = n()) %>% mutate(n = n / sum(n)) %>% spread(key, n)\n\n# calculate mean time SPOUSE\nukAll2015whomIIwomen %>% select(matches('spouse')) %>% gather %>% group_by(value) %>% summarise(n = n()) %>% mutate(timealone =  (n* 5) / 5653)\n\n# calculate mean time CHILDREN\nukAll2015whomIIwomen %>% select(matches('children')) %>% gather %>% group_by(value) %>% summarise(n = n()) %>% mutate(timealone =  (n* 5) / 5653)\n\n# calculate mean time OTHERS\nukAll2015whomIIwomen %>% select(matches('others')) %>% gather %>% group_by(value) %>% summarise(n = n()) %>% mutate(timealone =  (n* 5) / 5653)\n\n########### Individual mean time \n\nd = ukAll2015whomIIwomen %>% select(idind, day, matches('alone')) %>% melt(id.vars = c('idind', 'day'))\ntable(d$value) * 5 / count(ukAll2015whomIIwomen)\n\nukAll2015whomIIwomenIII = ukAll2015whomIIwomen %>% select(idind, day, matches('alone')) %>% melt(id.vars = c('idind', 'day')) %>% group_by(idind, day, value) %>% \n  summarise(timealone = n() * 5) %>% # be carefull in filtering MENTIONNED because you can delete individual in doing this -> when \n  spread(value, timealone, fill = 0)  \n\n# correct ?? -> 1440 \ntot = ( ukAll2015whomIIwomenIII$Mentioned %>% sum() ) + ( ukAll2015whomIIwomenIII$`Not mentioned` %>% sum() ) \ntot / count(ukAll2015whomIIwomenIII)\n\n# correct \nukAll2015whomIIwomenIII$Mentioned %>% mean(na.rm = T) %>% TimeClock()\nukAll2015whomIIwomenIII$Mentioned %>% mean(na.rm = T) %>% TimeProp\n\n625 + 993\n\n#\n\n########### Aggregate mean time - activities - check \n\n# NBR OF MEN \ncount(ukAll2015whomIImenI)\n# calculate mean time ALONE \nt = ukAll2015whomIImen %>% select(matches('main')) %>% gather %>% \n  group_by(value) %>% summarise(timealone = n()) %>% mutate(timealone =  (timealone* 5) / 5653) \n\nt %>% arrange(desc(timealone)) %>% mutate(TimeClock(timealone))\nt$timealone %>% sum \n\n#\n\n\nukAll2015_Men = merge(ukAll2015, withwhom2015, by = c('idind', 'day'))\ncount(ukAll2015_Men)\n\n# ",
    "created" : 1459009224548.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2236868573",
    "id" : "97DF7284",
    "lastKnownWriteTime" : 1458842538,
    "path" : "~/Rprojects/togetherness/rscripts/rscripts2015/uk 2016-03-24 # individual mean.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}