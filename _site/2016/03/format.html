<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Data Format</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

    <link rel="stylesheet" href="/motsetchoses/css/main.css">
    <link rel="canonical" href="http://giacomovagni.github.io/motsetchoses/2016/03/format.html">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>


  <body>

    <!--- Header and nav template site-wide -->
<header>
  <nav class="group">
    <a href="/motsetchoses\"><img class="badge" src="/motsetchoses/badge.png" alt="CH"></a>
    
      
        <a class="page-link" href="/motsetchoses/about/">About</a>
        
      
    
      
    
      
        <a class="page-link" href="/motsetchoses/Tags/index.html">Tags</a>
        
      
    
      
        <a class="page-link" href="/motsetchoses/TimeUse/index.html">time use</a>
        
      
    
      
    
      
        <a class="page-link" href="/motsetchoses/page/">page</a>
        
      
    
  </nav>
  
</header>

 

    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Data Format</h1>
    <p class="post-meta">Mar 23, 2016</p>
  </header>

 <hr width = 10%>

  <article class="post-content">
    <p><span class="newthought">This post</span> will discuss how to transform the 3 most common data format in Time Use using <code>R</code>.</p>

<p>The data formats will be referred to as :</p>

<p>a) Person Period Short format <br />
b) Person Period Long format <br />
c) State sequences (<em>Wide</em>) format</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># Load the libraries and data</span>

<span class="kn">library</span><span class="p">(</span>plyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>tidyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>mtusRlocal<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>knitr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>reshape2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>xtable<span class="p">)</span>

dta <span class="o">=</span> read.csv<span class="p">(</span><span class="s">&#39;/Users/giacomovagni/site/motsetchoses/_data/dtaSpells.csv&#39;</span><span class="p">)</span></code></pre></div>

<h3 id="person-period-short-format">Person Period Short format</h3>

<p>Time use data generally come into a shortened <em>Person-Period</em> format. 
Take a look at this sample :</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">id</th>
      <th style="text-align: center">day</th>
      <th style="text-align: center">activities</th>
      <th style="text-align: center">duration</th>
      <th style="text-align: center">epnum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">500</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">free time</td>
      <td style="text-align: center">400</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">eating</td>
      <td style="text-align: center">100</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">domestic</td>
      <td style="text-align: center">300</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">TV</td>
      <td style="text-align: center">140</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">300</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">paid work</td>
      <td style="text-align: center">500</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">eating</td>
      <td style="text-align: center">200</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">TV</td>
      <td style="text-align: center">400</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">eating</td>
      <td style="text-align: center">40</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">600</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">free time</td>
      <td style="text-align: center">300</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">eating</td>
      <td style="text-align: center">50</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">domestic</td>
      <td style="text-align: center">350</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">TV</td>
      <td style="text-align: center">140</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">400</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">paid work</td>
      <td style="text-align: center">600</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">eating</td>
      <td style="text-align: center">100</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">TV</td>
      <td style="text-align: center">300</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">eating</td>
      <td style="text-align: center">40</td>
      <td style="text-align: center">5</td>
    </tr>
  </tbody>
</table>

<div class="highlight"><pre><code class="language-r" data-lang="r">dtaPP <span class="o">=</span> dta<span class="p">[</span><span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>dta<span class="p">),</span> dta<span class="o">$</span>duration<span class="p">),</span> <span class="p">]</span> <span class="o">%&gt;%</span> 
  select<span class="p">(</span><span class="o">-</span>duration<span class="p">)</span> <span class="o">%&gt;%</span> 
  group_by<span class="p">(</span>id<span class="p">,</span> day<span class="p">)</span> <span class="o">%&gt;%</span> 
  mutate<span class="p">(</span> Time <span class="o">=</span> <span class="m">1</span><span class="o">:</span>n<span class="p">())</span></code></pre></div>

<h3 id="person-period-long-format">Person Period Long format</h3>

<p>Letâ€™s look at the first 10 entries</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">id</th>
      <th style="text-align: center">day</th>
      <th style="text-align: center">activities</th>
      <th style="text-align: center">epnum</th>
      <th style="text-align: center">Time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">7</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">8</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">9</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">10</td>
    </tr>
  </tbody>
</table>

<p>The maximum time per day is</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">dtaPP <span class="o">%&gt;%</span> group_by<span class="p">(</span>id<span class="p">,</span> day<span class="p">)</span> <span class="o">%&gt;%</span> summarise<span class="p">(</span><span class="kp">max</span><span class="p">(</span>Time<span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [4 x 3]
## Groups: id
## 
##   id      day max(Time)
## 1  1   Monday      1440
## 2  1 Saturday      1440
## 3  2   Monday      1440
## 4  2 Saturday      1440</code></pre></div>

<p>which means that we have created a one minute interval dataset, known as <strong>Long Person-Period</strong>:</p>

<h3 id="sequence-wide-format">Sequence (Wide) format</h3>

<p>This code enables to transform the long file into a <strong>Wide Sequence</strong> file.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">dtaWide <span class="o">=</span> dtaPP <span class="o">%&gt;%</span> select<span class="p">(</span><span class="o">-</span>epnum<span class="p">)</span> <span class="o">%&gt;%</span> spread<span class="p">(</span>Time<span class="p">,</span> activities<span class="p">)</span></code></pre></div>

<p>The 10 first sequence episodes look like this :</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">id</th>
      <th style="text-align: center">day</th>
      <th style="text-align: center">1</th>
      <th style="text-align: center">2</th>
      <th style="text-align: center">3</th>
      <th style="text-align: center">4</th>
      <th style="text-align: center">5</th>
      <th style="text-align: center">6</th>
      <th style="text-align: center">7</th>
      <th style="text-align: center">8</th>
      <th style="text-align: center">9</th>
      <th style="text-align: center">10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
    </tr>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Monday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Saturday</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
      <td style="text-align: center">sleep</td>
    </tr>
  </tbody>
</table>

<h3 id="return-to-short-pp-format">Return to short PP format</h3>

<p>A simple and convenient way to return to the original short PP way</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">dtaMeltPP <span class="o">=</span> dtaWide <span class="o">%&gt;%</span> melt<span class="p">(</span>id.vars <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;day&quot;</span><span class="p">))</span> <span class="o">%&gt;%</span> arrange<span class="p">(</span>id<span class="p">,</span> day<span class="p">,</span> variable<span class="p">)</span>
dtaMeltPP <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##   id    day variable value
## 1  1 Monday        1 sleep
## 2  1 Monday        2 sleep
## 3  1 Monday        3 sleep
## 4  1 Monday        4 sleep
## 5  1 Monday        5 sleep
## 6  1 Monday        6 sleep</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">dtaMeltPP <span class="o">%&gt;%</span> 
  group_by<span class="p">(</span>id<span class="p">,</span> day<span class="p">,</span> value<span class="p">)</span> <span class="o">%&gt;%</span> 
  mutate<span class="p">(</span>time <span class="o">=</span> n<span class="p">()</span> <span class="o">*</span> <span class="m">1</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  select<span class="p">(</span><span class="o">-</span>variable<span class="p">)</span> <span class="o">%&gt;%</span> distinct<span class="p">()</span> <span class="o">%&gt;%</span> <span class="c1"># keeps the order </span>
  group_by<span class="p">(</span>id<span class="p">,</span> day<span class="p">)</span> <span class="o">%&gt;%</span> 
  mutate<span class="p">(</span>epnum <span class="o">=</span> <span class="m">1</span><span class="o">:</span>n<span class="p">())</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [18 x 5]
## Groups: id, day
## 
##    id      day     value time epnum
## 1   1   Monday     sleep  300     1
## 2   1   Monday paid work  500     2
## 3   1   Monday    eating  240     3
## 4   1   Monday        TV  400     4
## 5   1 Saturday     sleep  500     1
## 6   1 Saturday free time  400     2
## 7   1 Saturday    eating  100     3
## 8   1 Saturday  domestic  300     4
## 9   1 Saturday        TV  140     5
## 10  2   Monday     sleep  400     1
## 11  2   Monday paid work  600     2
## 12  2   Monday    eating  140     3
## 13  2   Monday        TV  300     4
## 14  2 Saturday     sleep  600     1
## 15  2 Saturday free time  300     2
## 16  2 Saturday    eating   50     3
## 17  2 Saturday  domestic  350     4
## 18  2 Saturday        TV  140     5</code></pre></div>


  </article>

</div>

      </div>
    </div>

    <footer>
  <ul class="footer-links group">
    <li><a href="mailto:hate@spam.net"><span class="icon-mail"></span></a></li>
    
      <li>
        <a href="//www.twitter.com/jekyllrb"><span class="icon-twitter"></span></a>
      </li>
    
      <li>
        <a href="//plus.google.com/explore/jekyllrb"><span class="icon-googleplus"></span></a>
      </li>
    
      <li>
        <a href="//github.com/jekyll"><span class="icon-github"></span></a>
      </li>
    
      <li>
        <a href="//www.flickr.com/explore"><span class="icon-flickr"></span></a>
      </li>
    
      <li>
        <a href="/feed.xml"><span class="icon-feed"></span></a>
      </li>
    
  </ul>
<div class="credits">
<span>&copy; GIACOMO VAGNI &nbsp; 2016</span>
<br>
<span>This site was created with <a href="//github.com/cpsievert/knitr-jekyll">cpsievert/knitr-jekyll</a> -- a marriage of <a href="//github.com/yihui/knitr-jekyll">yihui/knitr-jekyll</a> and the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme</a> for <a href="//jekyllrb.com">Jekyll</a>.</span>
</div>
</footer>


  </body>

</html>
