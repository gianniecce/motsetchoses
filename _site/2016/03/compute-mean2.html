<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Compute mean for activities</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

    <link rel="stylesheet" href="/motsetchoses/css/main.css">
    <link rel="canonical" href="http://giacomovagni.github.io/motsetchoses/2016/03/compute-mean2.html">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>


  <body>

    <!--- Header and nav template site-wide -->
<header>
  <nav class="group">
    <a href="/motsetchoses\"><img class="badge" src="/motsetchoses/badge.png" alt="CH"></a>
    
      
        <a class="page-link" href="/motsetchoses/about/">About</a>
        
      
    
      
    
      
        <a class="page-link" href="/motsetchoses/Tags/index.html">Tags</a>
        
      
    
      
        <a class="page-link" href="/motsetchoses/TimeUse/index.html">time use</a>
        
      
    
      
    
      
        <a class="page-link" href="/motsetchoses/page/">page</a>
        
      
    
  </nav>
  
</header>

 

    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Compute mean for activities</h1>
    <p class="post-meta">Mar 16, 2016</p>
  </header>

 <hr width = 10%>

  <article class="post-content">
    <p><span class="newthought">This post</span> will demonstrate how to simply calcualte mean time of different activities from a <em>wide format</em> dataset.</p>

<ul>
  <li>Load the libraries and data</li>
</ul>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>plyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>tidyr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>mtusRlocal<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>knitr<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>reshape2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>xtable<span class="p">)</span>

<span class="kp">load</span><span class="p">(</span><span class="s">&#39;/Users/giacomovagni/site/motsetchoses/_data/ukAllsub.RData&#39;</span><span class="p">)</span></code></pre></div>

<p>Let us take a look at the data using <code>head</code></p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub <span class="o">%&gt;%</span> <span class="kp">head</span><span class="p">()</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##         idind  hldid survey   sex      day hhldsize
## 1 10121511974 101215   1974 Woman  Tuesday        3
## 2 10121511974 101215   1974 Woman Thursday        3
## 3 10121511974 101215   1974 Woman   Friday        3
## 4 10121511974 101215   1974 Woman Saturday        3
##                                         civstat                cohab
## 1 In couple (married/cohabit/civil partnership) could not be created
## 2 In couple (married/cohabit/civil partnership) could not be created
## 3 In couple (married/cohabit/civil partnership) could not be created
## 4 In couple (married/cohabit/civil partnership) could not be created
##   empsp                                  famstat season main1 main2
## 1  &lt;NA&gt; Aged 40+ with no coresident children &lt;18 Summer    NA    NA
## 2  &lt;NA&gt; Aged 40+ with no coresident children &lt;18 Summer    NA    NA
## 3  &lt;NA&gt; Aged 40+ with no coresident children &lt;18 Summer    NA    NA
## 4  &lt;NA&gt; Aged 40+ with no coresident children &lt;18 Summer    NA    NA
##   main3 main4 main5 main6 main7 main8 main9 main10 main11 main12
## 1    NA    NA    NA    NA    NA    NA    NA     NA     NA     NA
## 2    NA    NA    NA    NA    NA    NA    NA     NA     NA     NA
## 3    NA    NA    NA    NA    NA    NA    NA     NA     NA     NA
## 4    NA    NA    NA    NA    NA    NA    NA     NA     NA     NA
##   main13 main14 main15 main16 main17 main18 main19
## 1      2      2      2      2      2      2      2
## 2      6      6      6      6      6      6      2
## 3      2      2      2      2      2      2      2
## 4      2      2      2      2      2      2      2</code></pre></div>

<ul>
  <li>Individual-level mean</li>
</ul>

<p><span class="marginnote"> 
<script type="math/tex">x = {-b \pm \sqrt{b^2-4ac} \over 2a}.</script>
</span></p>

<p>We first need to compute the <em>mean</em> at the individual level for each activities.</p>

<p>Using <code>matches</code>, we select the relevant variables of the dataset.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub <span class="o">=</span> ukAllsub <span class="o">%&gt;%</span> group_by<span class="p">(</span>idind<span class="p">,</span> day<span class="p">)</span> <span class="o">%&gt;%</span> mutate<span class="p">(</span>ndiaries <span class="o">=</span> n<span class="p">())</span>
ukAllsub_act <span class="o">=</span> ukAllsub <span class="o">%&gt;%</span> select<span class="p">(</span> idind<span class="p">,</span> day<span class="p">,</span> ndiaries<span class="p">,</span> matches<span class="p">(</span><span class="s">&#39;main&#39;</span><span class="p">))</span></code></pre></div>

<p>The database looks like this</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub_act <span class="o">%&gt;%</span> <span class="kp">as.data.frame</span><span class="p">()</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">##         idind      day ndiaries main1 main2 main3 main4 main5 main6
## 1 10121511974  Tuesday        1    NA    NA    NA    NA    NA    NA
## 2 10121511974 Thursday        1    NA    NA    NA    NA    NA    NA
## 3 10121511974   Friday        1    NA    NA    NA    NA    NA    NA
## 4 10121511974 Saturday        1    NA    NA    NA    NA    NA    NA
##   main7 main8 main9 main10 main11 main12 main13 main14 main15 main16
## 1    NA    NA    NA     NA     NA     NA      2      2      2      2
## 2    NA    NA    NA     NA     NA     NA      6      6      6      6
## 3    NA    NA    NA     NA     NA     NA      2      2      2      2
## 4    NA    NA    NA     NA     NA     NA      2      2      2      2
##   main17 main18 main19
## 1      2      2      2
## 2      6      6      2
## 3      2      2      2
## 4      2      2      2</code></pre></div>

<p>We set up the <code>missing</code> values to <code>character</code></p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub_act<span class="p">[</span><span class="kp">is.na</span><span class="p">(</span>ukAllsub_act<span class="p">)]</span> <span class="o">&lt;-</span> <span class="s">&#39;NA&#39;</span></code></pre></div>

<p>The number of episode is</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># nbr of episodes </span>
<span class="m">19</span> <span class="o">*</span> <span class="m">5</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## [1] 95</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub_act_summary <span class="o">=</span> ukAllsub_act <span class="o">%&gt;%</span> melt<span class="p">(</span>id.vars <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;idind&#39;</span><span class="p">,</span> <span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="s">&#39;ndiaries&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  <span class="c1"># in order to retreive the time (nbr episodes) # </span>
  <span class="c1"># mutate(variable = substr(variable, 5, 6)) %&gt;% </span>
  group_by<span class="p">(</span>idind<span class="p">,</span> day<span class="p">,</span> ndiaries<span class="p">,</span> value<span class="p">)</span> <span class="o">%&gt;%</span> 
  summarise<span class="p">(</span>n <span class="o">=</span> n<span class="p">()</span> <span class="o">*</span> <span class="m">5</span><span class="p">)</span> <span class="o">%&gt;%</span>
  mutate<span class="p">(</span>value <span class="o">=</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&#39;act_&#39;</span><span class="p">,</span> value<span class="p">,</span> sep <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> 
  spread<span class="p">(</span>value<span class="p">,</span> n<span class="p">,</span> fill <span class="o">=</span> <span class="m">0</span><span class="p">)</span></code></pre></div>

<p>We get</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub_act_summary</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [4 x 6]
## 
##         idind      day ndiaries act_2 act_6 act_NA
## 1 10121511974  Tuesday        1    35     0     60
## 2 10121511974 Thursday        1     5    30     60
## 3 10121511974   Friday        1    35     0     60
## 4 10121511974 Saturday        1    35     0     60</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub_act_summary <span class="o">%&gt;%</span> select<span class="p">(</span>matches<span class="p">(</span><span class="s">&#39;act&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> summarise_each<span class="p">(</span>funs<span class="p">(</span><span class="kp">mean</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [1 x 3]
## 
##   act_2 act_6 act_NA
## 1  27.5   7.5     60</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">ukAllsub_act_summary <span class="o">%&gt;%</span> group_by<span class="p">(</span>day<span class="p">)</span> <span class="o">%&gt;%</span>  select<span class="p">(</span>day<span class="p">,</span> matches<span class="p">(</span><span class="s">&#39;act&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span> summarise_each<span class="p">(</span>funs<span class="p">(</span><span class="kp">mean</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [4 x 4]
## 
##        day act_2 act_6 act_NA
## 1  Tuesday    35     0     60
## 2 Thursday     5    30     60
## 3   Friday    35     0     60
## 4 Saturday    35     0     60</code></pre></div>


  </article>

</div>

      </div>
    </div>

    <footer>
  <ul class="footer-links group">
    <li><a href="mailto:hate@spam.net"><span class="icon-mail"></span></a></li>
    
      <li>
        <a href="//www.twitter.com/jekyllrb"><span class="icon-twitter"></span></a>
      </li>
    
      <li>
        <a href="//plus.google.com/explore/jekyllrb"><span class="icon-googleplus"></span></a>
      </li>
    
      <li>
        <a href="//github.com/jekyll"><span class="icon-github"></span></a>
      </li>
    
      <li>
        <a href="//www.flickr.com/explore"><span class="icon-flickr"></span></a>
      </li>
    
      <li>
        <a href="/feed.xml"><span class="icon-feed"></span></a>
      </li>
    
  </ul>
<div class="credits">
<span>&copy; GIACOMO VAGNI &nbsp; 2016</span>
<br>
<span>This site was created with <a href="//github.com/cpsievert/knitr-jekyll">cpsievert/knitr-jekyll</a> -- a marriage of <a href="//github.com/yihui/knitr-jekyll">yihui/knitr-jekyll</a> and the <a href="//github.com/clayh53/tufte-jekyll">Tufte theme</a> for <a href="//jekyllrb.com">Jekyll</a>.</span>
</div>
</footer>


  </body>

</html>
